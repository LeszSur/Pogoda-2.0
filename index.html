<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="UTF-8" />
  <script src="chart/chart.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  
  <link rel="stylesheet" href="style.css">
  <title>Pogodynka</title>
</head>

<body>
  <section id="wybor">
    <canvas id="field1" height="15" width="500"></canvas>
    <p>Wpisz miasto:</p>
    
    <input id="szukaj"></input>
    <button id="przyciskSzukaj">Znajdź</button>
    <select id="wpisyMiast"></select>
    <button id="przyciskUsun">Usuń wpisy</button>
  </section>

  <section>
  <h1 id="naglowek">Pogoda aktualna</h1>
  <div id="loader" class="loader">
    <img src="img/loading.svg" />
  </div>
  </section>

  <section>
    <div class="pogodaAktualna"> 
      <div>Temp. odczuwalna: <span class="temp_od"></span></div>
      <div>Wilgotność: <span class="wilgotnosc"></span></div>
      <div>Ciśnienie: <span class="cisnienie"></span></div>
      <div>Wiatr: <span class="wiatr"></span>
      <table>
        <tr><td id="wiatrAktualna">
        </td></tr>
      </table></div>
    </div>
    <div>
      <h1 id="opisAktualna"></h1>
      <h1 id="temp"></h1>
    </div>
    <div>
      <canvas id="obrazekAktualna" height="150" width="300"></canvas>
    </div>
  </section>

  <h3>Jakość powietrza:</h3>
  <div><strong><span class="powietrze"></strong></bold></div>
  <section>
  <div class="chart-bar">
    <canvas id="myChartAir" width="1040" height="150"></canvas>
      </div>
  </section>
  <section>
    <div>
    <canvas id="pm10" width="212" height="20"></canvas>
    <canvas id="pm25" width="212" height="20"></canvas>
    <canvas id="no2" width="212" height="20"></canvas>
    <canvas id="so2" width="212" height="20"></canvas>
    </div>
</section>
<section>
  <div>
  <canvas id="pm10t" width="209" height="20"></canvas>
  <canvas id="pm25t" width="209" height="20"></canvas>
  <canvas id="no2t" width="209" height="20"></canvas>
  <canvas id="so2t" width="209" height="20"></canvas>
  </div>
</section>
  
  <h3>Prognoza godzinowa:</h3>
  <section>
  <div class="chart-cnt">
    <canvas id="myChart" width="1040" height="200"></canvas>
    <canvas id="ico" width="1040" height="55"></canvas>
  </div>
  </section>
  <section>
    <div>
    <canvas id="timeg1" width="94" height="20"></canvas>
    <canvas id="timeg2" width="94" height="20"></canvas>
    <canvas id="timeg3" width="94" height="20"></canvas>
    <canvas id="timeg4" width="94" height="20"></canvas>
    <canvas id="timeg5" width="94" height="20"></canvas>
    <canvas id="timeg6" width="94" height="20"></canvas>
    <canvas id="timeg7" width="94" height="20"></canvas>
    <canvas id="timeg8" width="94" height="20"></canvas>
  </div>
</section>
<h3>Prognoza na najbliższe 3 dni:</h3>
  <section>
    <div id="panel">
      <h2 id="jutro"></h2>
      <canvas id="obrazekJutro" height="90"></canvas>
      <h2 id="opisJutro"></h2>
      <div class="pogodaJutro">
        <h2><span class="temp"></span></h2>
        <div>Wilgotność: <span class="wilgotnosc"></span></div>
        <div>
        <table>
          <tr>
            <td>Wiatr:</td>
            <td id="wiatrJutro"><span class="wiatr"></span></td>
            <td></td></tr>
            <td></td></tr>
        </table></div>
        </div>
      </div>

    <div id="panel">
      <h2 id="pojutrze"></h2>
      <canvas id="obrazekPojutrze" height="90"></canvas>
      <h2 id="opisPojutrze"></h2>
      <div class="pogodaPojutrze">
        <h2><span class="temp"></span></h2>
        <div>Wilgotność: <span class="wilgotnosc"></span></div>
          <table>
            <tr>
              <td>Wiatr:</td>
              <td id="wiatrPojutrze"><span class="wiatr"></span></td>
              <td></td></tr>
          </table>
        </div>
      </div>

    <div id="panel">
      <h2 id="zaTrzy"></h2>
      <canvas id="obrazekZa3" height="90"></canvas>
      <h2 id="opisZa3"></h2>
      <div class="pogodaZa3">
        <h2><span class="temp"></span></h2>
        <div>Wilgotność: <span class="wilgotnosc"></span></div>
          <table>
            <tr>
              <td>Wiatr:</td>
              <td id="wiatrZa3"><span class="wiatr"></span></td>
              <td></td></tr>
          </table>
    </div>
    </div>
  </section>

  <div>
    <p id="foot">Pogodynka LeszSur v2.2 - data.source: geoapify.com & openweathermap.org</p>
  </div>


  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">



    let elementTerazNaglowek = document.querySelector("#naglowek");
    let elementTerazOpis = document.querySelector("#opisAktualna");
    let elementTerazTemp = document.querySelector("#temp");
    let elementTerazTempO = document.querySelector(".pogodaAktualna .temp_od");
    let elementTerazWilgotnosc = document.querySelector(".pogodaAktualna .wilgotnosc");
    let elementTerazCisnienie = document.querySelector(".pogodaAktualna .cisnienie");
    let elementTerazPowietrze = document.querySelector(".powietrze");
    let elementTerazWiatr = document.querySelector(".pogodaAktualna .wiatr");

    let elementGodzinowa1 = document.querySelector(".pogodaGodzinowa .g1 #godz1");
    let elementGodzinowa2 = document.querySelector(".pogodaGodzinowa .g2 #godz2");
    let elementGodzinowa3 = document.querySelector(".pogodaGodzinowa .g3 #godz3");
    let elementGodzinowa4 = document.querySelector(".pogodaGodzinowa .g4 #godz4");
    let elementGodzinowa5 = document.querySelector(".pogodaGodzinowa .g5 #godz5");

    let elementGodzinowaT1 = document.querySelector(".pogodaGodzinowa .g1 #temp1");
    let elementGodzinowaT2 = document.querySelector(".pogodaGodzinowa .g2 #temp2");
    let elementGodzinowaT3 = document.querySelector(".pogodaGodzinowa .g3 #temp3");
    let elementGodzinowaT4 = document.querySelector(".pogodaGodzinowa .g4 #temp4");
    let elementGodzinowaT5 = document.querySelector(".pogodaGodzinowa .g5 #temp5");

    let elementGodzinowaO1 = document.querySelector(".pogodaGodzinowa .g1 #opis1");
    let elementGodzinowaO2 = document.querySelector(".pogodaGodzinowa .g2 #opis2");
    let elementGodzinowaO3 = document.querySelector(".pogodaGodzinowa .g3 #opis3");
    let elementGodzinowaO4 = document.querySelector(".pogodaGodzinowa .g4 #opis4");
    let elementGodzinowaO5 = document.querySelector(".pogodaGodzinowa .g5 #opis5");

    let elementGodzinowaW1 = document.querySelector(".pogodaGodzinowa .g1 #wiatr1");
    let elementGodzinowaW2 = document.querySelector(".pogodaGodzinowa .g2 #wiatr2");
    let elementGodzinowaW3 = document.querySelector(".pogodaGodzinowa .g3 #wiatr3");
    let elementGodzinowaW4 = document.querySelector(".pogodaGodzinowa .g4 #wiatr4");
    let elementGodzinowaW5 = document.querySelector(".pogodaGodzinowa .g5 #wiatr5");
  
    let elementJutroOpis = document.querySelector("#opisJutro");
    let elementJutroTemp = document.querySelector(".pogodaJutro .temp");
    let elementJutroZachmurzenie = document.querySelector(".pogodaJutro .zachmurzenie");
    let elementJutroWiatr = document.querySelector(".pogodaJutro .wiatr");
    let elementJutroWilgotnosc = document.querySelector(".pogodaJutro .wilgotnosc");

    let elementPojutrzeOpis = document.querySelector("#opisPojutrze");
    let elementPojutrzeTemp = document.querySelector(".pogodaPojutrze .temp");
    let elementPojutrzeZachmurzenie = document.querySelector(".pogodaPojutrze .zachmurzenie");
    let elementPojutrzeWiatr = document.querySelector(".pogodaPojutrze .wiatr");
    let elementPojutrzeWilgotnosc = document.querySelector(".pogodaPojutrze .wilgotnosc");

    let elementZa3Opis = document.querySelector("#opisZa3");
    let elementZa3Temp = document.querySelector(".pogodaZa3 .temp");
    let elementZa3Zachmurzenie = document.querySelector(".pogodaZa3 .zachmurzenie");
    let elementZa3Wiatr = document.querySelector(".pogodaZa3 .wiatr");
    let elementZa3Wilgotnosc = document.querySelector(".pogodaZa3 .wilgotnosc");

    let miasta = [];
    let putStorage = [];
    let nowyWpisMiasta = document.querySelector(".wpisyMiast");
    let szukaj = "";

    const czasPomiaru = new Date();
    const dzienPomiaru = czasPomiaru.getDay();
    const godzinaPomiaru = czasPomiaru.getHours();
    
    wstawDzień("#jutro", dzienPomiaru + 1);
    wstawDzień("#pojutrze", dzienPomiaru + 2);
    wstawDzień("#zaTrzy", dzienPomiaru + 3);



    function wstawDzień (sitePos, select){

      switch (select) {
        case 1: document.querySelector(sitePos).innerHTML = "poniedziałek";
          break;
        case 2: document.querySelector(sitePos).innerHTML = "wtorek";
          break;
        case 3: document.querySelector(sitePos).innerHTML = "środa";
          break;
        case 4: document.querySelector(sitePos).innerHTML = "czwartek";
          break;
        case 5: document.querySelector(sitePos).innerHTML = "piątek";
          break;
        case 6: document.querySelector(sitePos).innerHTML = "sobota";
          break;
        case 7: document.querySelector(sitePos).innerHTML = "niedziela";
          break;
        case 8: document.querySelector(sitePos).innerHTML = "poniedziałek";
          break;
        case 9: document.querySelector(sitePos).innerHTML = "wtorek";
          break;
    };
  };


 
    function lista(wpisMiasta) {
      let nowyWpisMiasta = document.createElement("option");
      nowyWpisMiasta.value = wpisMiasta;
      nowyWpisMiasta.innerHTML = wpisMiasta;
      document.querySelector("#wpisyMiast").appendChild(nowyWpisMiasta);
    };


    function wstawObrazek(select, sitePos, startPos, size) {

    const canvas = document.querySelector(sitePos);
    const ctx = canvas.getContext("2d");
    const image = new Image();

    image.addEventListener("load", e => {
      ctx.clearRect(startPos, 0, size, size);
      ctx.drawImage(image, startPos, 0, size, size);
    });
    switch (select) {
      case "01d": image.src = "img/slonce.png";
        break;
      case "01n": image.src = "img/slonce.png";
        break;
      case "02d": image.src = "img/chmury1.png";
        break;
      case "02n": image.src = "img/chmury1.png";
        break;
      case "03d": image.src = "img/chmury2.png";
        break;
      case "03n": image.src = "img/chmury2.png";
        break;
      case "04d": image.src = "img/chmury3.png";
        break;
      case "04n": image.src = "img/chmury3.png";
        break;
      case "09d": image.src = "img/deszcz2.png";
        break;
      case "09n": image.src = "img/deszcz2.png";
        break;
      case "10d": image.src = "img/deszcz1.png";
        break;
      case "10n": image.src = "img/deszcz1.png";
        break;
      case "11d": image.src = "img/burza.png";
        break;
      case "11n": image.src = "img/burza.png";
        break;  
      case "13d": image.src = "img/snieg.png";
        break;
      case "13n": image.src = "img/snieg.png";
        break;
      case "50d": image.src = "img/mgla.png";
        break;
      case "50n": image.src = "img/mgla.png";
        break;
      };
    };


    function ustawWiatr(parRotate, parSelector) {
      const obrot = 'rotate('+ parRotate +'deg)';
      document.querySelector(parSelector).innerHTML = "<img src='img/wiatr.png' width=35>";
      document.querySelector(parSelector).style.transform = obrot;
    } 

    function getCoordinates(parCity) {
            let adresCoordinates = "https://api.geoapify.com/v1/geocode/search?text=" + parCity + "&apiKey=5c1152da60b54e39b1f6e5dac9596307";
            fetch(adresCoordinates)
            .then(res => res.json())
            .then(res => { 
                lon = parseFloat(res.features[0].geometry.coordinates[0]);
                lat = parseFloat(res.features[0].geometry.coordinates[1]);
                getWeather(lat, lon);
            })
          }
          
    function getWeather(parLat, parLon){
        let adresWeather = "https://api.openweathermap.org/data/2.5/forecast?lat="+ parLat +"&lon="+ parLon +
                  "&lang=PL&units=metric&appid=992ff55e7b3c5989a38e4ff2e9ff1413";

                
                let wybor;          
                switch (godzinaPomiaru) {

                  case 0 : wybor = 13;
                  break;
                  case 1 : wybor = 13;
                  break;
                  case 2 : wybor = 13;
                  break; 
                  case 3 : wybor = 12;
                  break;
                  case 4 : wybor = 12;
                  break;
                  case 5 : wybor = 12;
                  break;
                  case 6 : wybor = 11;
                  break;
                  case 7 : wybor = 11;
                  break;
                  case 8 : wybor = 10;
                  break;
                  case 9 : wybor = 10;
                  break; 
                  case 10 : wybor = 9;
                  break; 
                  case 11 : wybor = 9;
                  break;
                  case 12 : wybor = 9;
                  break;
                  case 13 : wybor = 8;
                  break; 
                  case 14 : wybor = 8;
                  break;
                  case 15 : wybor = 8;
                  break;
                  case 16 : wybor = 7;
                  break;
                  case 17 : wybor = 7;
                  break;
                  case 18 : wybor = 7;
                  break;
                  case 19 : wybor = 6;
                  break;
                  case 20 : wybor = 6;
                  break;
                  case 21 : wybor = 6;
                  break;
                  case 22 : wybor = 5;
                  break;
                  case 23 : wybor = 5;
                  break;
          
                }

      fetch(adresWeather)
      .then(res => res.json())
      .then(res => { 

          console.log(res);

          console.log();

          loader.classList.add("visible"); 

          setTimeout(() => {

          loader.classList.remove("visible");

            elementTerazNaglowek.innerHTML = "Pogoda aktualna - " + res.city.name + " " + res.city.country;
            elementTerazOpis.innerHTML = res.list[0].weather[0].description;
            wstawObrazek(res.list[0].weather[0].icon, "#obrazekAktualna", 60, 160);
            ustawWiatr(res.list[0].wind.deg, "#wiatrAktualna");
            elementTerazTemp.innerHTML = Math.round(res.list[0].main.temp) + " °C";
            elementTerazTempO.innerHTML = Math.round(res.list[0].main.feels_like) + " °C";
            elementTerazWilgotnosc.innerHTML = res.list[0].main.humidity + " %";
            elementTerazCisnienie.innerHTML = res.list[0].main.pressure + " hPa";
            elementTerazWiatr.innerHTML = res.list[0].wind.speed + " m/s";

            wstawObrazek(res.list[1].weather[0].icon, "#ico", 10, 49);
            wstawObrazek(res.list[2].weather[0].icon, "#ico", 150, 49);
            wstawObrazek(res.list[3].weather[0].icon, "#ico", 290, 49);
            wstawObrazek(res.list[4].weather[0].icon, "#ico", 430, 49);
            wstawObrazek(res.list[5].weather[0].icon, "#ico", 570, 49);
            wstawObrazek(res.list[6].weather[0].icon, "#ico", 710, 49);
            wstawObrazek(res.list[7].weather[0].icon, "#ico", 850, 49);
            wstawObrazek(res.list[8].weather[0].icon, "#ico", 990, 49);

            timeDraw(res.list[1].dt_txt, "#timeg1", 15);
            timeDraw(res.list[2].dt_txt, "#timeg2", 15);
            timeDraw(res.list[3].dt_txt, "#timeg3", 15);
            timeDraw(res.list[4].dt_txt, "#timeg4", 15);
            timeDraw(res.list[5].dt_txt, "#timeg5", 15);
            timeDraw(res.list[6].dt_txt, "#timeg6", 15);
            timeDraw(res.list[7].dt_txt, "#timeg7", 15);
            timeDraw(res.list[8].dt_txt, "#timeg8", 15);
            
            elementJutroOpis.innerHTML = res.list[wybor].weather[0].description;
            wstawObrazek(res.list[wybor].weather[0].icon, "#obrazekJutro", 20, 90);
            ustawWiatr(res.list[wybor].wind.deg, "#wiatrJutro");
            elementJutroTemp.innerHTML = Math.round(res.list[wybor].main.temp) + " °C";
            elementJutroWiatr.innerHTML = res.list[wybor].wind.speed + " m/s";
            elementJutroWilgotnosc.innerHTML = res.list[0].main.humidity + " %";

            elementPojutrzeOpis.innerHTML = res.list[wybor+8].weather[0].description;
            wstawObrazek(res.list[wybor+8].weather[0].icon, "#obrazekPojutrze", 20, 90);
            ustawWiatr(res.list[wybor+8].wind.deg, "#wiatrPojutrze");
            elementPojutrzeTemp.innerHTML = Math.round(res.list[wybor+8].main.temp) + " °C";
            elementPojutrzeWiatr.innerHTML = res.list[wybor+8].wind.speed + " m/s";
            elementPojutrzeWilgotnosc.innerHTML = res.list[0].main.humidity + " %";

            elementZa3Opis.innerHTML = res.list[wybor+16].weather[0].description; 
            wstawObrazek(res.list[wybor+16].weather[0].icon, "#obrazekZa3", 20, 90);
            ustawWiatr(res.list[wybor+16].wind.deg, "#wiatrZa3");
            elementZa3Temp.innerHTML = Math.round(res.list[wybor+16].main.temp) + " °C";
            elementZa3Wiatr.innerHTML = res.list[wybor+16].wind.speed + " m/s";
            elementZa3Wilgotnosc.innerHTML = res.list[0].main.humidity + " %";
            
          }, 250);

            function tempChart (parText) {
              let tempText = Math.round(res.list[parText].main.temp) + " °C";
              return tempText};

            function timeChart (parText) {
              let String;
              let TextString;
              String = res.list[parText].main.temp;
              TextString = String.toString();
              return TextString};

             function timeDraw (parText, sitePos, startPos) {
              let timeText = parText.slice(11, 16);
              const canvas = document.querySelector(sitePos);
              const ctx = canvas.getContext("2d");
              ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)
              ctx.font = "18px Arial";
              ctx.fillStyle = 'black';
              ctx.fillText(timeText, 15, startPos)};

        let dataChart = {
            labels: [],
            datasets: [
                 {label: "",
                  borderDash: [3, 3], 
                  borderColor : 'rgba(236,115,87, 0.7)',
                  pointBorderColor : 'rgba(236,115,87, 0.7)',
                  borderWidth : 2,
                  fill: true, 
                  backgroundColor : 'rgba(236,115,87, 0.1)',
                  pointRadius : 4,
                  pointBorderWidth : 1,
                  pointBackgroundColor : 'rgba(255,255,255,1)',
                  pointHoverRadius: 6,
                  pointHoverBorderWidth: 3,
                  pointHoverBackgroundColor : 'rgba(255,255,255,1)',
                  pointHoverBorderColor : 'rgba(236,115,87, 1)',
                  data: [], }
             ]};

        let optionsChart = {
                plugins:{
                  tooltip:{
                    enabled: false,
                  },
                  legend:{
                    labels:{
                      generateLabels: false,
                    }
                  }
                }
              };


              
        for (i=0; i<8; i++){
        
          dataChart.labels.push(tempChart(i));
          dataChart.datasets[0].data.push(timeChart(i))
        };

      Chart.defaults.font.size = 18;

      let canvasDraw = document.querySelector("#myChart");

      let ctxDraw = canvasDraw.getContext("2d");

      myLineChart = new Chart(ctxDraw, {
      type: 'line',
      data: dataChart,
      options: optionsChart
      });

            let adresAir = "https://api.openweathermap.org/data/2.5/air_pollution?lat="
                    + parLat +"&lon=" + parLon + "&appid=992ff55e7b3c5989a38e4ff2e9ff1413";
            fetch(adresAir)
            .then(res => res.json())
            .then(res => { 

              let colorAirPM10;
              let colorAirPM25; 
              let colorAirNO2;
              let colorAirSO2;

              if ((res.list[0].components.pm10) > 201 || (res.list[0].components.pm2_5) > 121 || (res.list[0].components.no2) > 401 || (res.list[0].components.so2) > 501)  
                          {elementTerazPowietrze.innerHTML = "bardzo zła"; elementTerazPowietrze.style.color = 'rgb(153, 102, 255)'}
              else if (((res.list[0].components.pm10 > 141) && (res.list[0].components.pm10 <= 201)) || ((res.list[0].components.pm2_5 > 85) && (res.list[0].components.pm2_5 <= 121)) ||
                       ((res.list[0].components.no2 > 201) && (res.list[0].components.no2 <= 401)) || ((res.list[0].components.so2 > 351) && (res.list[0].components.so2 <= 501)))
                          {elementTerazPowietrze.innerHTML = "zła", elementTerazPowietrze.style.color = 'rgb(255, 99, 132)'}
              else if (((res.list[0].components.pm10 > 101) && (res.list[0].components.pm10 <= 141)) || ((res.list[0].components.pm2_5 > 61) && (res.list[0].components.pm2_5 <= 85)) ||
                       ((res.list[0].components.no2 > 151) && (res.list[0].components.no2 <= 201)) || ((res.list[0].components.so2 > 201) && (res.list[0].components.so2 <= 351)))  
                          {elementTerazPowietrze.innerHTML = "dostateczna"; elementTerazPowietrze.style.color = 'rgb(255, 159, 64)'}
              else if (((res.list[0].components.pm10 > 61) && (res.list[0].components.pm10 <= 101)) || ((res.list[0].components.pm2_5 > 37) && (res.list[0].components.pm2_5 <= 61)) ||
                       ((res.list[0].components.no2 > 101) && (res.list[0].components.no2 <= 151)) || ((res.list[0].components.so2 > 101) && (res.list[0].components.so2 <= 201)))  
                          {elementTerazPowietrze.innerHTML = "umiarkowana"; elementTerazPowietrze.style.color = 'rgb(255, 205, 86)'}
              else if (((res.list[0].components.pm10 > 21) && (res.list[0].components.pm10 <= 61)) || ((res.list[0].components.pm2_5 > 13) && (res.list[0].components.pm2_5 <= 37)) ||
                       ((res.list[0].components.no2 > 41) && (res.list[0].components.no2 <= 101)) || ((res.list[0].components.so2 > 51) && (res.list[0].components.so2 <= 101)))  
                          {elementTerazPowietrze.innerHTML = "dobra"; elementTerazPowietrze.style.color = 'rgb(28, 199, 57)'}
              else if (((res.list[0].components.pm10 > 0) && (res.list[0].components.pm10 <= 21)) || ((res.list[0].components.pm2_5 > 0) && (res.list[0].components.pm2_5 <= 13)) ||
                       ((res.list[0].components.no2 > 0) && (res.list[0].components.no2 <= 41)) || ((res.list[0].components.so2 > 0) && (res.list[0].components.so2 <= 51)))
                          { elementTerazPowietrze.innerHTML = "bardzo dobra"; elementTerazPowietrze.style.color = 'rgb(54, 162, 235)'};


              if (res.list[0].components.pm10 > 201) {colorAirPM10 = 'rgba(153, 102, 255, 0.2)'; colorBorderAir10 = 'rgb(153, 102, 255)'; textAirDraw("b.zły", "#pm10t", 15, 0)}
              else if ((res.list[0].components.pm10 > 141) && (res.list[0].components.pm10 <= 201)) {colorAirPM10 = 'rgba(255, 99, 132, 0.2)'; colorBorderAir10 = 'rgb(255, 99, 132)'; textAirDraw(" zły ", "#pm10t", 15, 1)}
              else if ((res.list[0].components.pm10 > 101) && (res.list[0].components.pm10 <= 141)) {colorAirPM10 = 'rgba(255, 159, 64, 0.2)'; colorBorderAir10 = 'rgb(255, 159, 64)'; textAirDraw("dost.", "#pm10t", 15, 2)}
              else if ((res.list[0].components.pm10 > 61) && (res.list[0].components.pm10 <= 101)) {colorAirPM10 = 'rgba(255, 205, 86, 0.2)'; colorBorderAir10 = 'rgb(255, 205, 86)'; textAirDraw("umiar.", "#pm10t", 15, 3)}
              else if ((res.list[0].components.pm10 > 21) && (res.list[0].components.pm10 <= 61)) {colorAirPM10 = 'rgba(28, 199, 57, 0.2)'; colorBorderAir10 = 'rgb(28, 199, 57)'; textAirDraw(" db ", "#pm10t", 15, 4)}
              else if ((res.list[0].components.pm10 > 0) && (res.list[0].components.pm10 <= 21)) {colorAirPM10 = 'rgba(54, 162, 235, 0.2)'; colorBorderAir10 = 'rgb(54, 162, 235)'; textAirDraw(" bdb ", "#pm10t", 15, 5)};


              if (res.list[0].components.pm2_5 > 121) {colorAirPM25 = 'rgba(153, 102, 255, 0.2)'; colorBorderAir25 = 'rgb(153, 102, 255)'; textAirDraw("b.zły", "#pm25t", 15, 0)}
              else if ((res.list[0].components.pm2_5 > 85) && (res.list[0].components.pm2_5 <= 121)) {colorAirPM25 = 'rgba(255, 99, 132, 0.2)'; colorBorderAir25 = 'rgb(255, 99, 132)'; textAirDraw(" zły ", "#pm25t", 15, 1)}
              else if ((res.list[0].components.pm2_5 > 61) && (res.list[0].components.pm2_5 <= 85)) {colorAirPM25 = 'rgba(255, 159, 64, 0.2)'; colorBorderAir25 = 'rgb(255, 159, 64)'; textAirDraw("dost.", "#pm25t", 15, 2)}
              else if ((res.list[0].components.pm2_5 > 37) && (res.list[0].components.pm2_5 <= 61)) {colorAirPM25 = 'rgba(255, 205, 86, 0.2)'; colorBorderAir25 = 'rgb(255, 205, 86)'; textAirDraw("umiar.", "#pm25t", 15, 3)}
              else if ((res.list[0].components.pm2_5 > 13) && (res.list[0].components.pm2_5 <= 37)) {colorAirPM25 = 'rgba(28, 199, 57, 0.2)'; colorBorderAir25 = 'rgb(28, 199, 57)'; textAirDraw(" db ", "#pm25t", 15, 4)}
              else if ((res.list[0].components.pm2_5 > 0) && (res.list[0].components.pm2_5 <= 13)) {colorAirPM25 = 'rgba(54, 162, 235, 0.2)'; colorBorderAir25 = 'rgb(54, 162, 235)'; textAirDraw(" bdb ", "#pm25t", 15, 5)};
           
              if (res.list[0].components.no2 > 401) {colorAirNo2 = 'rgba(153, 102, 255, 0.2)'; colorBorderAirNo2 = 'rgb(153, 102, 255)'; textAirDraw("b.zły", "#no2t", 15, 0)}
              else if ((res.list[0].components.no2 > 201) && (res.list[0].components.no2 <= 401)) {colorAirNo2 = 'rgba(255, 99, 132, 0.2)'; colorBorderAirNo2 = 'rgb(255, 99, 132)'; textAirDraw(" zły ", "#no2t", 15, 1)}
              else if ((res.list[0].components.no2 > 151) && (res.list[0].components.no2 <= 201)) {colorAirNo2 = 'rgba(255, 159, 64, 0.2)'; colorBorderAirNo2 = 'rgb(255, 159, 64)'; textAirDraw("dost.", "#no2t", 15, 2)}
              else if ((res.list[0].components.no2 > 101) && (res.list[0].components.no2 <= 151)) {colorAirNo2 = 'rgba(255, 205, 86, 0.2)'; colorBorderAirNo2 = 'rgb(255, 205, 86)'; textAirDraw("umiar.", "#no2t", 15, 3)}
              else if ((res.list[0].components.no2 > 41) && (res.list[0].components.no2 <= 101)) {colorAirNo2 = 'rgba(28, 199, 57, 0.2)'; colorBorderAirNo2 = 'rgb(28, 199, 57)'; textAirDraw(" db ", "#no2t", 15, 4)}
              else if ((res.list[0].components.no2 > 0) && (res.list[0].components.no2 <= 41)) {colorAirNo2 = 'rgba(54, 162, 235, 0.2)'; colorBorderAirNo2 = 'rgb(54, 162, 235)'; textAirDraw(" bdb ", "#no2t", 15, 5)};
           
              if (res.list[0].components.so2 > 501) {colorAirNo2 = 'rgba(153, 102, 255, 0.2)'; colorBorderAirNo2 = 'rgb(153, 102, 255)'; textAirDraw("b.zły", "#so2t", 15, 0)}
              else if ((res.list[0].components.so2 > 351) && (res.list[0].components.so2 <= 501)) {colorAirSo2 = 'rgba(255, 99, 132, 0.2)'; colorBorderAirSo2 = 'rgb(255, 99, 132)'; textAirDraw(" zły ", "#so2t", 15, 1)}
              else if ((res.list[0].components.so2 > 201) && (res.list[0].components.so2 <= 351)) {colorAirSo2 = 'rgba(255, 159, 64, 0.2)'; colorBorderAirSo2 = 'rgb(255, 159, 64)'; textAirDraw("dost.", "#so2t", 15, 2)}
              else if ((res.list[0].components.so2 > 101) && (res.list[0].components.so2 <= 201)) {colorAirSo2 = 'rgba(255, 205, 86, 0.2)'; colorBorderAirSo2 = 'rgb(255, 205, 86)'; textAirDraw("umiar.", "#so2t", 15, 3)}
              else if ((res.list[0].components.so2 > 51) && (res.list[0].components.so2 <= 101)) {colorAirSo2 = 'rgba(28, 199, 57, 0.2)'; colorBorderAirSo2 = 'rgb(28, 199, 57)'; textAirDraw(" db ", "#so2t", 15, 4)}
              else if ((res.list[0].components.so2 > 0) && (res.list[0].components.so2 <= 51)) {colorAirSo2 = 'rgba(54, 162, 235, 0.2)'; colorBorderAirSo2 = 'rgb(54, 162, 235)'; textAirDraw(" bdb ", "#so2t", 15, 5)};
           
            dataAirDraw(res.list[0].components.pm10 + " µg/m3", "#pm10", 15);
            dataAirDraw(res.list[0].components.pm2_5 + " µg/m3", "#pm25", 15);
            dataAirDraw(res.list[0].components.no2 + " µg/m3", "#no2", 15);
            dataAirDraw(res.list[0].components.so2 + " µg/m3", "#so2", 15);

              let dataChartAir = {
            labels: ["PM10", "PM2,5", "no2", "so2"],
            datasets: [
                 {label: "",
                 data: [res.list[0].components.pm10, res.list[0].components.pm2_5, res.list[0].components.no2, res.list[0].components.so2],
            backgroundColor: [
              colorAirPM10,
              colorAirPM25,
              colorAirNo2,
              colorAirSo2,
              ],
            borderColor: [
              colorBorderAir10,
              colorBorderAir25,
              colorBorderAirNo2,
              colorBorderAirSo2,
              ],
            borderWidth: 1 }
             ]};

        let optionsChartAir = {
                plugins:{
                  tooltip:{
                    enabled: false,
                  },
                  legend:{
                    labels:{
                      generateLabels: false,
                    }
                  }
                }
            };

        let canvasDrawAir = document.querySelector("#myChartAir");

        let ctxDrawAir = canvasDrawAir.getContext("2d");

        myBarChart = new Chart(ctxDrawAir, {
        type: 'bar',
        data: dataChartAir,
        options: optionsChartAir
        });

        function dataAirDraw (parText, sitePos, startPos) {
              const canvas = document.querySelector(sitePos);
              const ctx = canvas.getContext("2d");
              ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)
              ctx.font = "18px Arial";
              ctx.fillStyle = 'grey';
              ctx.fillText(parText, 110, startPos)};

        function textAirDraw (parText, sitePos, startPos, color) {
              const canvas = document.querySelector(sitePos);
              const ctx = canvas.getContext("2d");
              ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)
              ctx.font = "16px bold Arial";
              switch (color) {
                  case 0 : ctx.fillStyle = 'rgb(153, 102, 255';
                  break;
                  case 1 : ctx.fillStyle = 'rgb(255, 99, 132)';
                  break;
                  case 2 : ctx.fillStyle = 'rgb(255, 159, 64)';
                  break; 
                  case 3 : ctx.fillStyle = 'rgb(255, 205, 86)';
                  break;
                  case 4 : ctx.fillStyle = 'rgb(28, 199, 57)';
                  break;
                  case 5 : ctx.fillStyle = 'rgb(54, 162, 235)';
                  break;};

              ctx.fillText(parText, 140, startPos)};              
                    })
                  })

    .catch(error => document.querySelector("#opisAktualna").innerHTML = "błąd wczytywania danych")
                };


      window.addEventListener("load", () => {

        loader.classList.add("visible"); 

          setTimeout(() => {

          loader.classList.remove("visible");
      
      navigator.geolocation.getCurrentPosition((position) => {
        let lon = position.coords.longitude;
        let lat = position.coords.latitude;
        getWeather(lat, lon);
      });
        
        let getStorage = localStorage.getItem("miasta");
                if (getStorage === null) {
                    lista("");
                    miasta.push("");
                    return;}
                else {
            getStorage = JSON.parse(localStorage.getItem("miasta"))       
                   
                    for (i=0; i < getStorage.length; i++) {
                      miasta.push(getStorage[i]);
                      lista(miasta[miasta.length - 1]);}
            }; 
          }, 250);    
    });

      document.querySelector("#wpisyMiast").addEventListener("change", (wybor) => {
              let mojWybor = wybor.target.value;
              myLineChart.destroy();
              myBarChart.destroy();
              getCoordinates(mojWybor);
      });

      document.querySelector("#przyciskSzukaj").addEventListener("click", () => {
              myLineChart.destroy();
              myBarChart.destroy();
              let parCity = document.querySelector("#szukaj").value;
              getCoordinates(parCity);
              miasta.push(parCity);
              lista(parCity);
              localStorage.setItem("miasta", JSON.stringify(miasta));
              document.querySelector("#szukaj").value = "";
      });

      document.querySelector("#przyciskUsun").addEventListener("click", () => {
                let div = document.querySelector("#wpisyMiast"), child;
                while ((child = div.firstChild)) {
                div.removeChild(child);
                };
                miasta.length = 0;
                localStorage.clear();
      });
        
    </script>
</body>

</html>
