<!DOCTYPE html>
<html lang="pl">

<head>
  <meta charset="UTF-8" />
  <script src="node_modules/chart.js/dist/chart.min.js"></script>
  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  
  <link rel="stylesheet" href="style.css">
  <title>Pogodynka</title>
</head>

<body>
  <section id="wybor">
    <canvas id="field1" height="15"></canvas>
    <canvas id="field2" height="15"></canvas>
    <p>Wpisz miasto:</p>
    <input id="szukaj"></input>
    <button id="przycisk">Znajdź</button>
  </section>

  <section>
  <h1 id="naglowek">Pogoda aktualna</h1>
  <div id="loader" class="loader">
    <img src="img/loading.svg" />
  </div>
  </section>

  <section>
    <div class="pogodaAktualna"> 
      <div>Temp. odczuwalna: <span class="temp_od"></span></div>
      <div>Ciśnienie: <span class="cisnienie"></span></div>
      <div>Powietrze: <span class="powietrze"></span></div>
      <div>Wiatr: <span class="wiatr"></span>
      <table>
        <tr><td id="wiatrAktualna">
        </td></tr>
      </table></div>
    </div>
    <div>
      <h1 id="opisAktualna"></h1>
      <h1 id="temp"></h1>
    </div>
    <div>
      <canvas id="obrazekAktualna" height="140" width="300"></canvas>
    </div>
  </section>

  <h3>Prognoza godzinowa:</h3>
  <section>
  <div class="chart-cnt">
    <canvas id="myChart" width="1040" height="200"></canvas>
    <canvas id="ico" width="1040" height="60"></canvas>
  </div>
</section>
<h3>Prognoza na najbliższe 3 dni:</h3>
  <section>
    <div id="panel">
      <h2 id="jutro"></h2>
      <canvas id="obrazekJutro" height="120"></canvas>
      <h2 id="opisJutro"></h2>
      <div class="pogodaJutro">
        <div>Temperatura: <span class="temp"></span></div>
        <div>Wiatr: <span class="wiatr"></span>
        <table>
          <tr><td id="wiatrJutro">
          </td></tr>
        </table></div>

      </div>

    </div>
    <div id="panel">
      <h2 id="pojutrze"></h2>
      <canvas id="obrazekPojutrze" height="120"></canvas>
      <h2 id="opisPojutrze"></h2>
      <div class="pogodaPojutrze">
        <div>Temperatura: <span class="temp"></span></div>
        <div>Wiatr: <span class="wiatr"></span>
        <table>
          <tr><td id="wiatrPojutrze">
          </td></tr>
        </table></div>
      </div>
    </div>
    <div id="panel">
      <h2 id="zaTrzy"></h2>
      <canvas id="obrazekZa3" height="120"></canvas>
      <h2 id="opisZa3"></h2>
      <div class="pogodaZa3">
        <div>Temperatura: <span class="temp"></span></div>
        <div>Wiatr: <span class="wiatr"></span>
        <table>
          <tr><td id="wiatrZa3">
          </td></tr>
        </table></div>
      </div>
    </div>
  </section>

  <div>
    <p></p>
    <div id="containerMessages"></div>
  </div>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">



    let elementTerazNaglowek = document.querySelector("#naglowek");
    let elementTerazOpis = document.querySelector("#opisAktualna");
    let elementTerazTemp = document.querySelector("#temp");
    let elementTerazTempO = document.querySelector(".pogodaAktualna .temp_od");
    let elementTerazCisnienie = document.querySelector(".pogodaAktualna .cisnienie");
    let elementTerazPowietrze = document.querySelector(".pogodaAktualna .powietrze");
    let elementTerazWiatr = document.querySelector(".pogodaAktualna .wiatr");

    let elementGodzinowa1 = document.querySelector(".pogodaGodzinowa .g1 #godz1");
    let elementGodzinowa2 = document.querySelector(".pogodaGodzinowa .g2 #godz2");
    let elementGodzinowa3 = document.querySelector(".pogodaGodzinowa .g3 #godz3");
    let elementGodzinowa4 = document.querySelector(".pogodaGodzinowa .g4 #godz4");
    let elementGodzinowa5 = document.querySelector(".pogodaGodzinowa .g5 #godz5");

    let elementGodzinowaT1 = document.querySelector(".pogodaGodzinowa .g1 #temp1");
    let elementGodzinowaT2 = document.querySelector(".pogodaGodzinowa .g2 #temp2");
    let elementGodzinowaT3 = document.querySelector(".pogodaGodzinowa .g3 #temp3");
    let elementGodzinowaT4 = document.querySelector(".pogodaGodzinowa .g4 #temp4");
    let elementGodzinowaT5 = document.querySelector(".pogodaGodzinowa .g5 #temp5");

    let elementGodzinowaO1 = document.querySelector(".pogodaGodzinowa .g1 #opis1");
    let elementGodzinowaO2 = document.querySelector(".pogodaGodzinowa .g2 #opis2");
    let elementGodzinowaO3 = document.querySelector(".pogodaGodzinowa .g3 #opis3");
    let elementGodzinowaO4 = document.querySelector(".pogodaGodzinowa .g4 #opis4");
    let elementGodzinowaO5 = document.querySelector(".pogodaGodzinowa .g5 #opis5");

    let elementGodzinowaW1 = document.querySelector(".pogodaGodzinowa .g1 #wiatr1");
    let elementGodzinowaW2 = document.querySelector(".pogodaGodzinowa .g2 #wiatr2");
    let elementGodzinowaW3 = document.querySelector(".pogodaGodzinowa .g3 #wiatr3");
    let elementGodzinowaW4 = document.querySelector(".pogodaGodzinowa .g4 #wiatr4");
    let elementGodzinowaW5 = document.querySelector(".pogodaGodzinowa .g5 #wiatr5");
  
    let elementJutroOpis = document.querySelector("#opisJutro");
    let elementJutroTemp = document.querySelector(".pogodaJutro .temp");
    let elementJutroZachmurzenie = document.querySelector(".pogodaJutro .zachmurzenie");
    let elementJutroWiatr = document.querySelector(".pogodaJutro .wiatr");

    let elementPojutrzeOpis = document.querySelector("#opisPojutrze");
    let elementPojutrzeTemp = document.querySelector(".pogodaPojutrze .temp");
    let elementPojutrzeZachmurzenie = document.querySelector(".pogodaPojutrze .zachmurzenie");
    let elementPojutrzeWiatr = document.querySelector(".pogodaPojutrze .wiatr");

    let elementZa3Opis = document.querySelector("#opisZa3");
    let elementZa3Temp = document.querySelector(".pogodaZa3 .temp");
    let elementZa3Zachmurzenie = document.querySelector(".pogodaZa3 .zachmurzenie");
    let elementZa3Wiatr = document.querySelector(".pogodaZa3 .wiatr");

    let miasta = [];
    let nowyWpisMiasta = document.querySelector(".wpisyMiast");
    let szukaj = "";
    let elementPrzycisk = document.querySelector("#przycisk");
    let loader = document.querySelector("#loader");
    let myLineChart;

    const czasPomiaru = new Date();
    const dzienPomiaru = czasPomiaru.getDay();
    const godzinaPomiaru = czasPomiaru.getHours();
    
    wstawDzień("#jutro", dzienPomiaru, 1);
    wstawDzień("#pojutrze", dzienPomiaru, 2);
    wstawDzień("#zaTrzy", dzienPomiaru, 3);



    function wstawDzień (a, b, c){

      const dzienWstaw = (b + c);

      switch (dzienWstaw) {
        case 1: document.querySelector(a).innerHTML = "poniedziałek";
          break;
        case 2: document.querySelector(a).innerHTML = "wtorek";
          break;
        case 3: document.querySelector(a).innerHTML = "środa";
          break;
        case 4: document.querySelector(a).innerHTML = "czwartek";
          break;
        case 5: document.querySelector(a).innerHTML = "piątek";
          break;
        case 6: document.querySelector(a).innerHTML = "sobota";
          break;
        case 7: document.querySelector(a).innerHTML = "niedziela";
          break;
        case 8: document.querySelector(a).innerHTML = "poniedziałek";
          break;
        case 9: document.querySelector(a).innerHTML = "wtorek";
          break;
    };
  };


 
    function lista(wpisMiasta) {
      let nowyWpisMiasta = document.createElement("option");
      nowyWpisMiasta.value = wpisMiasta;
      nowyWpisMiasta.innerHTML = wpisMiasta;
      document.querySelector(".wpisyMiast").appendChild(nowyWpisMiasta);
    };


    function wstawObrazekGodz(a, b, c) {

const canvas = document.querySelector(b);
const ctx = canvas.getContext("2d");
const image = new Image();

image.addEventListener("load", e => {
  ctx.clearRect(c, 0, 50, 50);
  ctx.drawImage(image, c, 0, 50, 50);
});
switch (a) {
  case "01d": image.src = "img/slonce.png";
    break;
  case "01n": image.src = "img/slonce.png";
    break;
  case "02d": image.src = "img/chmury1.png";
    break;
  case "02n": image.src = "img/chmury1.png";
    break;
  case "03d": image.src = "img/chmury2.png";
    break;
  case "03n": image.src = "img/chmury2.png";
    break;
  case "04d": image.src = "img/chmury3.png";
    break;
  case "04n": image.src = "img/chmury3.png";
    break;
  case "09d": image.src = "img/deszcz2.png";
    break;
  case "09n": image.src = "img/deszcz2.png";
    break;
  case "10d": image.src = "img/deszcz1.png";
    break;
  case "10n": image.src = "img/deszcz1.png";
    break;
  case "11d": image.src = "img/burza.png";
    break;
  case "11n": image.src = "img/burza.png";
    break;  
  case "13d": image.src = "img/snieg.png";
    break;
  case "13n": image.src = "img/snieg.png";
    break;
  case "50d": image.src = "img/mgla.png";
    break;
  case "50n": image.src = "img/mgla.png";
    break;
};
};


    function wstawObrazek(a, b, c) {

      const canvas = document.querySelector(b);
      const ctx = canvas.getContext("2d");
      const image = new Image();

      image.addEventListener("load", e => {
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        ctx.drawImage(image, 0, 0, c, c);
      });
      switch (a) {
        case "01d": image.src = "img/slonce.png";
          break;
        case "01n": image.src = "img/slonce.png";
          break;
        case "02d": image.src = "img/chmury1.png";
          break;
        case "02n": image.src = "img/chmury1.png";
          break;
        case "03d": image.src = "img/chmury2.png";
          break;
        case "03n": image.src = "img/chmury2.png";
          break;
        case "04d": image.src = "img/chmury3.png";
          break;
        case "04n": image.src = "img/chmury3.png";
          break;
        case "09d": image.src = "img/deszcz2.png";
          break;
        case "09n": image.src = "img/deszcz2.png";
          break;
        case "10d": image.src = "img/deszcz1.png";
          break;
        case "10n": image.src = "img/deszcz1.png";
          break;
        case "11d": image.src = "img/burza.png";
          break;
        case "11n": image.src = "img/burza.png";
          break;  
        case "13d": image.src = "img/snieg.png";
          break;
        case "13n": image.src = "img/snieg.png";
          break;
        case "50d": image.src = "img/mgla.png";
          break;
        case "50n": image.src = "img/mgla.png";
          break;
      };
    };

    function ustawWiatr(parRotate, parSelector) {
      const obrot = 'rotate('+ parRotate +'deg)';
      document.querySelector(parSelector).innerHTML = "<img src='img/wiatr.png' width=35>";
      document.querySelector(parSelector).style.transform = obrot;
    } 

    function getCoordinates(parCity) {
            let adresCoordinates = "https://api.geoapify.com/v1/geocode/search?text=" + parCity + "&apiKey=5c1152da60b54e39b1f6e5dac9596307";
            fetch(adresCoordinates)
            .then(res => res.json())
            .then(res => { 
                lon = parseFloat(res.features[0].geometry.coordinates[0]);
                lat = parseFloat(res.features[0].geometry.coordinates[1]);
                getWeather(lat, lon);
            })
          }
          
    function getWeather(parLat, parLon){
                let adresWeather = "https://api.openweathermap.org/data/2.5/forecast?lat="+ parLat +"&lon="+ parLon +
                  "&lang=PL&units=metric&appid=992ff55e7b3c5989a38e4ff2e9ff1413";

                
                let wybor;          
                switch (godzinaPomiaru) {

                  case 0 : wybor = 13;
                  break;
                  case 1 : wybor = 13;
                  break;
                  case 2 : wybor = 13;
                  break; 
                  case 3 : wybor = 12;
                  break;
                  case 4 : wybor = 12;
                  break;
                  case 5 : wybor = 12;
                  break;
                  case 6 : wybor = 11;
                  break;
                  case 7 : wybor = 11;
                  break;
                  case 8 : wybor = 10;
                  break;
                  case 9 : wybor = 10;
                  break; 
                  case 10 : wybor = 9;
                  break; 
                  case 11 : wybor = 9;
                  break;
                  case 12 : wybor = 9;
                  break;
                  case 13 : wybor = 8;
                  break; 
                  case 14 : wybor = 8;
                  break;
                  case 15 : wybor = 8;
                  break;
                  case 16 : wybor = 7;
                  break;
                  case 17 : wybor = 7;
                  break;
                  case 18 : wybor = 7;
                  break;
                  case 19 : wybor = 6;
                  break;
                  case 20 : wybor = 6;
                  break;
                  case 21 : wybor = 6;
                  break;
                  case 22 : wybor = 5;
                  break;
                  case 23 : wybor = 5;
                  break;
          
                }

                  fetch(adresWeather)
                  .then(res => res.json())
                  .then(res => { 

            elementTerazNaglowek.innerHTML = "Pogoda aktualna - " + res.city.name + " " + res.city.country;
            elementTerazOpis.innerHTML = res.list[0].weather[0].description;
            wstawObrazek(res.list[0].weather[0].icon, "#obrazekAktualna", 140);
            ustawWiatr(res.list[0].wind.deg, "#wiatrAktualna");
            elementTerazTemp.innerHTML = Math.round(res.list[0].main.temp) + " °C";
            elementTerazTempO.innerHTML = Math.round(res.list[0].main.feels_like) + " °C";
            elementTerazCisnienie.innerHTML = res.list[0].main.pressure + " hPa";
            elementTerazWiatr.innerHTML = res.list[0].wind.speed + " m/s";

            elementJutroOpis.innerHTML = res.list[wybor].weather[0].description;
            wstawObrazek(res.list[wybor].weather[0].icon, "#obrazekJutro", 90);
            ustawWiatr(res.list[wybor].wind.deg, "#wiatrJutro");
            elementJutroTemp.innerHTML = Math.round(res.list[wybor].main.temp) + " °C";
            elementJutroWiatr.innerHTML = res.list[wybor].wind.speed + " m/s";

            elementPojutrzeOpis.innerHTML = res.list[wybor+8].weather[0].description;
            wstawObrazek(res.list[wybor+8].weather[0].icon, "#obrazekPojutrze", 90);
            ustawWiatr(res.list[wybor+8].wind.deg, "#wiatrPojutrze");
            elementPojutrzeTemp.innerHTML = Math.round(res.list[wybor+8].main.temp) + " °C";
            elementPojutrzeWiatr.innerHTML = res.list[wybor+8].wind.speed + " m/s";

            elementZa3Opis.innerHTML = res.list[wybor+16].weather[0].description; 
            wstawObrazek(res.list[wybor+16].weather[0].icon, "#obrazekZa3", 90);
            ustawWiatr(res.list[wybor+16].wind.deg, "#wiatrZa3");
            elementZa3Temp.innerHTML = Math.round(res.list[wybor+16].main.temp) + " °C";
            elementZa3Wiatr.innerHTML = res.list[wybor+16].wind.speed + " m/s";
            


            function Text (parText) {
              let String;
              let ShortString;
              let Temp;
              let TextString;
              String = (res.list[parText].dt_txt);
              ShortString = (String.slice(11, 16));
              Temp = ShortString + " - " + Math.round(res.list[parText].main.temp) + " °C ";
              TextString = Temp.toString();

              return TextString;  
            };

            function Temp (parTemp) {
              let String;
              let TextString;
              String = res.list[parTemp].main.temp;
              TextString = String.toString();

              return TextString;  
            };


            /*elementGodzinowa1.innerHTML = Text(1);
            elementGodzinowa2.innerHTML = Text(2);
            elementGodzinowa3.innerHTML = Text(3);
            elementGodzinowa4.innerHTML = Text(4);
            elementGodzinowa5.innerHTML = Text(5);

            elementGodzinowaT1.innerHTML = res.list[1].main.temp + " °C ";
            elementGodzinowaT2.innerHTML = res.list[2].main.temp + " °C ";
            elementGodzinowaT3.innerHTML = res.list[3].main.temp + " °C ";
            elementGodzinowaT4.innerHTML = res.list[4].main.temp + " °C ";
            elementGodzinowaT5.innerHTML = res.list[5].main.temp + " °C ";

            wstawObrazekGodzinowa(res.list[1].weather[0].icon, "#ico1");
            wstawObrazekGodzinowa(res.list[2].weather[0].icon, ".pogodaGodzinowa .g2 #ico2");
            wstawObrazekGodzinowa(res.list[3].weather[0].icon, ".pogodaGodzinowa .g3 #ico3");
            wstawObrazekGodzinowa(res.list[4].weather[0].icon, ".pogodaGodzinowa .g4 #ico4");
            wstawObrazekGodzinowa(res.list[5].weather[0].icon, ".pogodaGodzinowa .g5 #ico5"); */

            wstawObrazekGodz(res.list[1].weather[0].icon, "#ico", 55);
            wstawObrazekGodz(res.list[2].weather[0].icon, "#ico", 280);
            wstawObrazekGodz(res.list[3].weather[0].icon, "#ico", 516);
            wstawObrazekGodz(res.list[4].weather[0].icon, "#ico", 740);
            wstawObrazekGodz(res.list[5].weather[0].icon, "#ico", 960);

            /*elementGodzinowaO1.innerHTML = res.list[1].weather[0].description;
            elementGodzinowaO2.innerHTML = res.list[2].weather[0].description;
            elementGodzinowaO3.innerHTML = res.list[3].weather[0].description;
            elementGodzinowaO4.innerHTML = res.list[4].weather[0].description;
            elementGodzinowaO5.innerHTML = res.list[5].weather[0].description;

            elementGodzinowaW1.innerHTML = "wiatr: "+res.list[1].wind.speed+" m/s";
            elementGodzinowaW2.innerHTML = "wiatr: "+res.list[2].wind.speed+" m/s";
            elementGodzinowaW3.innerHTML = "wiatr: "+res.list[3].wind.speed+" m/s";
            elementGodzinowaW4.innerHTML = "wiatr: "+res.list[4].wind.speed+" m/s";
            elementGodzinowaW5.innerHTML = "wiatr: "+res.list[5].wind.speed+" m/s"; */


  
    let data = {
    labels: [],
    datasets: [
        {
            label: "",
            //linia
            borderDash: [3, 3], //jezeli ustawione to przerywana linia
            borderColor : 'rgba(236,115,87, 0.7)',
            pointBorderColor : 'rgba(236,115,87, 0.7)',
            borderWidth : 2,
            //kolor tla i legendy
            fill: true, //czy wypelnic zbior
            backgroundColor : 'rgba(236,115,87, 0.1)', //wplywa tez na kolor w legendzie
            //ustawienia punktu
            pointRadius : 4,
            pointBorderWidth : 1,
            pointBackgroundColor : 'rgba(255,255,255,1)',
            //ustawienia punktu hover
            pointHoverRadius: 6,
            pointHoverBorderWidth: 3,
            pointHoverBackgroundColor : 'rgba(255,255,255,1)',
            pointHoverBorderColor : 'rgba(236,115,87, 1)',
            data: [],
        }
        
    ]
};



let options = {
  plugins:{
    legend:{
      labels:{
        generateLabels: "",
      }
    }
  }
};

data.labels = [Text(1), Text(2), Text(3), Text(4), Text(5)];
data.datasets[0].data = [Temp(1), Temp(2), Temp(3), Temp(4), Temp(5)];


Chart.defaults.font.size = 18;

let canvasDraw = document.querySelector("#myChart");

let ctxDraw = canvasDraw.getContext("2d");

    myLineChart = new Chart(ctxDraw, {
    type: 'line',
    data: data,
    options: options
});



            let adresAir = "https://api.openweathermap.org/data/2.5/air_pollution?lat="
                    + parLat +"&lon=" + parLon + "&appid=992ff55e7b3c5989a38e4ff2e9ff1413";
            fetch(adresAir)
            .then(res => res.json())
            .then(res => { 
              elementTerazPowietrze.innerHTML = "PM10: " + res.list[0].components.pm10 + ", PM2.5: " + res.list[0].components.pm2_5;
                    })
                  })
                };


    window.addEventListener("load", () => {
      
      navigator.geolocation.getCurrentPosition((position) => {
        let lon = position.coords.longitude;
        let lat = position.coords.latitude;
        getWeather(lat, lon);  
        });
      });

    document.querySelector("#przycisk").addEventListener("click", () => {
        myLineChart.destroy();
        let parCity = document.querySelector("#szukaj").value;
        getCoordinates(parCity);
      });
  
  </script>
</body>

</html>
